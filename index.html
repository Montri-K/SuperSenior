<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>ตารางคะแนน Super Senior League</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- โหลด Tabletop.js ก่อน -->
  <script src="https://unpkg.com/tabletop@1.6.4/tabletop.js"></script>

  <style>
    body {
      font-family: sans-serif;
      margin: 20px;
      text-align: center;
      padding: 0 10px;
    }

    h1, h2 {
      font-size: 20px;
      margin-top: 30px;
    }

    table {
      border-collapse: collapse;
      width: 100%;
      margin: 20px auto;
      overflow-x: auto;
      display: block;
    }

    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      font-size: 14px;
    }

    th {
      background-color: #f0f0f0;
    }

    @media screen and (max-width: 480px) {
      th, td {
        font-size: 12px;
        padding: 6px;
      }

      h1, h2 {
        font-size: 18px;
      }
    }
  </style>
</head>

<body>
  <h1>ผลการแข่งขัน: Super Senior League</h1>

  <table id="matchResults">
    <thead>
      <tr><th>คู่ที่</th><th>ทีมเหย้า</th><th>ประตู</th><th>ทีมเยือน</th><th>ประตู</th></tr>
    </thead>
    <tbody></tbody>
  </table>

  <h2>ตารางคะแนน</h2>

  <table id="leagueTable">
    <thead>
      <tr>
        <th>ทีม</th><th>แข่ง</th><th>ชนะ</th><th>เสมอ</th><th>แพ้</th>
        <th>ได้</th><th>เสีย</th><th>แต้ม</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const sheetKey = "1RUxRuAEX3fuDZNI2JKdft-rYm55oIQC15_gj9WViuSI";
      const teams = {};

      Tabletop.init({
        key: sheetKey,
        simpleSheet: true,
        callback: function (data) {
          data.forEach((r) => {
            const home = r.home?.trim();
            const away = r.away?.trim();
            const hg = parseInt(r.homeGoals);
            const ag = parseInt(r.awayGoals);

            if (!home || !away || isNaN(hg) || isNaN(ag)) return;

            // แสดงผลการแข่งขัน
            document.querySelector("#matchResults tbody").innerHTML += `
              <tr><td>${r.match}</td><td>${home}</td><td>${hg}</td><td>${away}</td><td>${ag}</td></tr>
            `;

            // เตรียมทีม
            [home, away].forEach(t => {
              if (!teams[t]) teams[t] = {
                name: t, played: 0, won: 0, draw: 0, lost: 0, gf: 0, ga: 0, pts: 0
              };
            });

            // อัปเดตสถิติ
            teams[home].played++; teams[away].played++;
            teams[home].gf += hg; teams[home].ga += ag;
            teams[away].gf += ag; teams[away].ga += hg;

            if (hg > ag) {
              teams[home].won++; teams[home].pts += 3; teams[away].lost++;
            } else if (hg < ag) {
              teams[away].won++; teams[away].pts += 3; teams[home].lost++;
            } else {
              teams[home].draw++; teams[away].draw++;
              teams[home].pts++; teams[away].pts++;
            }
          });

          // เรียงลำดับตารางคะแนน
          const sorted = Object.values(teams).sort((a, b) =>
            b.pts - a.pts || (b.gf - b.ga) - (a.gf - a.ga) || b.gf - a.gf
          );

          sorted.forEach((t, i) => {
            const row = document.createElement("tr");
            row.innerHTML = `
              <td>${t.name}</td><td>${t.played}</td><td>${t.won}</td><td>${t.draw}</td>
              <td>${t.lost}</td><td>${t.gf}</td><td>${t.ga}</td><td>${t.pts}</td>
            `;
            document.querySelector("#leagueTable tbody").appendChild(row);
          });
        }
      });
    });
  </script>
</body>
</html>